<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>servw: Código-Fonte de src/client.h</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">servw
   
   </div>
   <div id="projectbrief">A simple web server</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Gerado por Doxygen 1.7.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Busca');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Página&#160;Principal</span></a></li>
      <li><a href="pages.html"><span>Páginas&#160;relacionadas</span></a></li>
      <li><a href="annotated.html"><span>Estruturas&#160;de&#160;Dados</span></a></li>
      <li class="current"><a href="files.html"><span>Arquivos</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Busca" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>Lista&#160;de&#160;Arquivos</span></a></li>
      <li><a href="globals.html"><span>Globais</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/client.h</div>  </div>
</div>
<div class="contents">
<a href="client_8h.html">Vá para a documentação deste arquivo.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="preprocessor">#ifndef CLIENT_H_DEFINED</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="preprocessor">#define CLIENT_H_DEFINED</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#define BUFFER_SIZE  256</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="keyword">struct </span><a class="code" href="structc__handler__list.html">c_handler_list</a>
<a name="l00020"></a>00020 {
<a name="l00021"></a><a class="code" href="structc__handler__list.html#aaede1e019a8e47f5958816d7d023abfa">00021</a>   <span class="keywordtype">int</span> <a class="code" href="structc__handler__list.html#aaede1e019a8e47f5958816d7d023abfa" title="Quantos handlers estao servindo clientes agora.">current</a>;           
<a name="l00022"></a><a class="code" href="structc__handler__list.html#a0f8f23516461fa3ac536b4c50c7c7294">00022</a>   <span class="keywordtype">int</span> <a class="code" href="structc__handler__list.html#a0f8f23516461fa3ac536b4c50c7c7294" title="Maximo de handlers possiveis ao mesmo tempo.">max</a>;               
<a name="l00024"></a><a class="code" href="structc__handler__list.html#a51e2205f099981d10b5709725950a892">00024</a>   <span class="keyword">struct </span>c_handler* <a class="code" href="structc__handler__list.html#a51e2205f099981d10b5709725950a892" title="Primeiro handler na lista.">begin</a>; 
<a name="l00025"></a><a class="code" href="structc__handler__list.html#ad2eb40545e9d26f2788e94366ac0dd16">00025</a>   <span class="keyword">struct </span>c_handler* <a class="code" href="structc__handler__list.html#ad2eb40545e9d26f2788e94366ac0dd16" title="Ultimo handler na lista.">end</a>;   
<a name="l00026"></a>00026 }
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="keyword">struct </span>c_handler
<a name="l00029"></a>00029 {
<a name="l00030"></a>00030   <span class="keyword">struct </span>c_handler* <a class="code" href="client_8h.html#a64b4b47b91604aea52f82f4c53be30eb" title="Proximo handler na lista.">next</a>; 
<a name="l00032"></a><a class="code" href="client_8h.html#a4bf947cca001e8ca0cd9def2b8d058c7">00032</a>   <span class="keywordtype">int</span>  <a class="code" href="client_8h.html#a4bf947cca001e8ca0cd9def2b8d058c7" title="Socket do cliente servido.">client</a>;                   
<a name="l00033"></a><a class="code" href="client_8h.html#a89f234133d3efe315836311cbf21c64b">00033</a>   <span class="keywordtype">int</span>  <a class="code" href="client_8h.html#a89f234133d3efe315836311cbf21c64b" title="Estado em que se encontra o handler.">state</a>;                    
<a name="l00034"></a><a class="code" href="client_8h.html#ac335bc5a2e39b758609fbcffe9afb655">00034</a>   <span class="keywordtype">char</span> <a class="code" href="client_8h.html#ac335bc5a2e39b758609fbcffe9afb655" title="Toda a request HTTP solicitada pelo cliente.">request</a>[BUFFER_SIZE * 3]; 
<a name="l00035"></a><a class="code" href="client_8h.html#a6b35e60d8f76c0579c20b6991faea124">00035</a>   <span class="keywordtype">int</span>  <a class="code" href="client_8h.html#a6b35e60d8f76c0579c20b6991faea124" title="Tamanho de caracteres que &#39;request&#39; suporta.">request_size</a>;             
<a name="l00036"></a><a class="code" href="client_8h.html#a48fe36a0f6a836dae2fad1921fa31011">00036</a>   <span class="keywordtype">char</span> <a class="code" href="client_8h.html#a48fe36a0f6a836dae2fad1921fa31011" title="Localizacao do arquivo que o cliente solicitou.">filepath</a>[BUFFER_SIZE];    
<a name="l00037"></a><a class="code" href="client_8h.html#a6c1bfa8ca8ab99f4d6060ad595ed1c1f">00037</a>   <span class="keywordtype">int</span>  <a class="code" href="client_8h.html#a6c1bfa8ca8ab99f4d6060ad595ed1c1f" title="Indica se o arquivo existe ou qual erro esta associado a ele.">filestatus</a>;               
<a name="l00039"></a><a class="code" href="client_8h.html#ab002322962a2928046c6bfb9a2369ef5">00039</a>   <span class="keywordtype">char</span> <a class="code" href="client_8h.html#ab002322962a2928046c6bfb9a2369ef5" title="Mensagem equivalente ao status do arquivo.">filestatusmsg</a>[BUFFER_SIZE]; 
<a name="l00040"></a><a class="code" href="client_8h.html#a2937a41bde0307e87626b85452766f89">00040</a>   FILE* <a class="code" href="client_8h.html#a2937a41bde0307e87626b85452766f89" title="Arquivo que o cliente pede.">filep</a>;                   
<a name="l00041"></a><a class="code" href="client_8h.html#ae95eb7d7fba43b6d535d7ca585cbb462">00041</a>   <span class="keywordtype">int</span>   <a class="code" href="client_8h.html#ae95eb7d7fba43b6d535d7ca585cbb462" title="Tamanho do arquivo solicitado.">filesize</a>;                
<a name="l00042"></a><a class="code" href="client_8h.html#a98df962b4c3eff4cbc0d2dbe28803287">00042</a>   <span class="keywordtype">int</span>   <a class="code" href="client_8h.html#a98df962b4c3eff4cbc0d2dbe28803287" title="Tamanho que ja foi enviado do arquivo como um todo.">filesentsize</a>;            
<a name="l00043"></a><a class="code" href="client_8h.html#afcd711474b6ce12f1240083836951c8b">00043</a>   time_t <a class="code" href="client_8h.html#afcd711474b6ce12f1240083836951c8b" title="Data de ultima modificacao do arquivo.">filelastm</a>;              
<a name="l00044"></a><a class="code" href="client_8h.html#a8c5486db43d6259271344bcd9fe8728c">00044</a>   <span class="keywordtype">char</span> <a class="code" href="client_8h.html#a8c5486db43d6259271344bcd9fe8728c" title="Buffer onde serao guardadas partes temporarias do arquivo.">filebuff</a>[BUFFER_SIZE];    
<a name="l00045"></a><a class="code" href="client_8h.html#aa852d22bcf33eb1f89c19bf2effa91c2">00045</a>   <span class="keywordtype">char</span>  <a class="code" href="client_8h.html#aa852d22bcf33eb1f89c19bf2effa91c2" title="Header a ser enviado como resposta ao cliente, antes do arquivo.">answer</a>[BUFFER_SIZE];     
<a name="l00046"></a><a class="code" href="client_8h.html#a9cffa535187d8075aa365abe6d894787">00046</a>   <span class="keywordtype">int</span>   <a class="code" href="client_8h.html#a9cffa535187d8075aa365abe6d894787" title="O tamanho total do header.">answer_size</a>;             
<a name="l00048"></a><a class="code" href="client_8h.html#a8bc01e89439d07a1b549a3edfa36f679">00048</a>   <span class="keywordtype">int</span> <a class="code" href="client_8h.html#a8bc01e89439d07a1b549a3edfa36f679" title="Quanto do arquivo (caso exista) ainda precisa ser enviado ao cliente.">size_left</a>; 
<a name="l00049"></a><a class="code" href="client_8h.html#a08ae67fd0bb0b776b40701244ea532be">00049</a>   <span class="keywordtype">int</span> <a class="code" href="client_8h.html#a08ae67fd0bb0b776b40701244ea532be" title="Quanto do arquivo (caso exista) ja foi enviado ao cliente.">size_sent</a>; 
<a name="l00051"></a>00051   <span class="keywordtype">char</span> fileerror[BUFFER_SIZE]; 
<a name="l00053"></a><a class="code" href="client_8h.html#a887b58fe4129ef46e6bf1327d865781c">00053</a>   <span class="keywordtype">int</span> <a class="code" href="client_8h.html#a887b58fe4129ef46e6bf1327d865781c" title="Se houver algum erro relacionado ao arquivo, sua mensagem estara aqui (no formato de pagina HTML) par...">fileerrorsize</a>; 
<a name="l00054"></a><a class="code" href="client_8h.html#a47866494eb84961e021291efbea9b569">00054</a>   <span class="keywordtype">char</span> *<a class="code" href="client_8h.html#a47866494eb84961e021291efbea9b569" title="Ponteiro que vai indicar o que vai ser enviado - o erro ou o header.">output</a>; 
<a name="l00056"></a>00056   <span class="keywordtype">int</span> need_file_chunk;           
<a name="l00057"></a>00057 }
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 
<a name="l00065"></a><a class="code" href="client_8h.html#a6e03ded01aa2e7560ad6f1d4a531fcdd">00065</a> <span class="keywordtype">int</span> <a class="code" href="client_8h.html#a6e03ded01aa2e7560ad6f1d4a531fcdd" title="Flag que indica se precisa pegar um pedaco do arquivo.">c_handler_list_init</a>(<span class="keyword">struct</span> <a class="code" href="structc__handler__list.html">c_handler_list</a>* l, <span class="keywordtype">int</span> max_clients)
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067     <span class="keywordflow">if</span> (l == NULL)
<a name="l00068"></a>00068       <span class="keywordflow">return</span> -1;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     l-&gt;<a class="code" href="structc__handler__list.html#aaede1e019a8e47f5958816d7d023abfa" title="Quantos handlers estao servindo clientes agora.">current</a> = 0;
<a name="l00071"></a>00071     l-&gt;<a class="code" href="structc__handler__list.html#a0f8f23516461fa3ac536b4c50c7c7294" title="Maximo de handlers possiveis ao mesmo tempo.">max</a>     = max_clients;
<a name="l00072"></a>00072     l-&gt;<a class="code" href="structc__handler__list.html#a51e2205f099981d10b5709725950a892" title="Primeiro handler na lista.">begin</a>   = NULL;
<a name="l00073"></a>00073     l-&gt;<a class="code" href="structc__handler__list.html#ad2eb40545e9d26f2788e94366ac0dd16" title="Ultimo handler na lista.">end</a>     = NULL;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075     <span class="keywordflow">return</span> 0;
<a name="l00076"></a>00076 }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 
<a name="l00084"></a><a class="code" href="client_8h.html#ab174d5d209c238f7576d8a449e298cb9">00084</a> <span class="keywordtype">int</span> <a class="code" href="client_8h.html#ab174d5d209c238f7576d8a449e298cb9" title="Inicializa as variaveis internas de &#39;h&#39;, como o cliente &#39;sck&#39; e o diretorio root &#39;rootdir&#39;.">c_handler_init</a>(<span class="keyword">struct</span> c_handler* h, <span class="keywordtype">int</span> sck, <span class="keywordtype">char</span>* rootdir)
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086   <span class="keywordflow">if</span> (h != NULL)
<a name="l00087"></a>00087     <span class="keywordflow">return</span> -1;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089   h = malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> c_handler));
<a name="l00090"></a>00090   <span class="keywordflow">if</span> (h == NULL)
<a name="l00091"></a>00091     <span class="keywordflow">return</span> -1;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   h-&gt;next = NULL;
<a name="l00094"></a>00094   h-&gt;client = sck;
<a name="l00095"></a>00095   h-&gt;state = MSG_RECEIVING;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097   memset(&amp;(h-&gt;request),       <span class="charliteral">&#39;\0&#39;</span>, BUFFER_SIZE);
<a name="l00098"></a>00098   memset(&amp;(h-&gt;answer),        <span class="charliteral">&#39;\0&#39;</span>, BUFFER_SIZE);
<a name="l00099"></a>00099   memset(&amp;(h-&gt;fileerror),     <span class="charliteral">&#39;\0&#39;</span>, BUFFER_SIZE);
<a name="l00100"></a>00100   memset(&amp;(h-&gt;filepath),      <span class="charliteral">&#39;\0&#39;</span>, BUFFER_SIZE);
<a name="l00101"></a>00101   memset(&amp;(h-&gt;filestatusmsg), <span class="charliteral">&#39;\0&#39;</span>, BUFFER_SIZE);
<a name="l00102"></a>00102 
<a name="l00103"></a>00103   h-&gt;request_size = BUFFER_SIZE * 3;
<a name="l00104"></a>00104   h-&gt;output = NULL;
<a name="l00105"></a>00105   h-&gt;filep  = NULL;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   h-&gt;answer_size = -1;
<a name="l00108"></a>00108 
<a name="l00109"></a>00109   strncpy(h-&gt;filepath, rootdir, BUFFER_SIZE);
<a name="l00110"></a>00110   h-&gt;filestatus = -1;
<a name="l00111"></a>00111   h-&gt;filesize   = -1;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113   <span class="keywordflow">return</span> 0;
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 
<a name="l00121"></a><a class="code" href="client_8h.html#aa13ffa5cc36f7171aa0e2a7b4ed7fabf">00121</a> <span class="keywordtype">int</span> <a class="code" href="client_8h.html#aa13ffa5cc36f7171aa0e2a7b4ed7fabf" title="Adiciona &#39;h&#39; a lista &#39;l&#39;.">c_handler_add</a>(<span class="keyword">struct</span> c_handler* h, <span class="keyword">struct</span> <a class="code" href="structc__handler__list.html">c_handler_list</a>* l)
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123   <span class="keywordflow">if</span> ((h == NULL) || (l == NULL))
<a name="l00124"></a>00124     <span class="keywordflow">return</span> -1;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126   <span class="keywordflow">if</span> (l-&gt;<a class="code" href="structc__handler__list.html#aaede1e019a8e47f5958816d7d023abfa" title="Quantos handlers estao servindo clientes agora.">current</a> == l-&gt;<a class="code" href="structc__handler__list.html#a0f8f23516461fa3ac536b4c50c7c7294" title="Maximo de handlers possiveis ao mesmo tempo.">max</a>)
<a name="l00127"></a>00127     <span class="keywordflow">return</span> -1;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129   <span class="keywordflow">if</span> (l-&gt;<a class="code" href="structc__handler__list.html#a51e2205f099981d10b5709725950a892" title="Primeiro handler na lista.">begin</a> == NULL)
<a name="l00130"></a>00130   {
<a name="l00131"></a>00131     l-&gt;<a class="code" href="structc__handler__list.html#a51e2205f099981d10b5709725950a892" title="Primeiro handler na lista.">begin</a> = h;
<a name="l00132"></a>00132     l-&gt;<a class="code" href="structc__handler__list.html#ad2eb40545e9d26f2788e94366ac0dd16" title="Ultimo handler na lista.">end</a>   = h;
<a name="l00133"></a>00133   }
<a name="l00134"></a>00134   <span class="keywordflow">else</span>
<a name="l00135"></a>00135   {
<a name="l00136"></a>00136     <span class="keyword">struct </span>c_handler* tmp = l-&gt;<a class="code" href="structc__handler__list.html#a51e2205f099981d10b5709725950a892" title="Primeiro handler na lista.">begin</a>;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     <span class="keywordflow">while</span> (tmp-&gt;next != NULL)
<a name="l00139"></a>00139       tmp = tmp-&gt;next;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141     tmp-&gt;next = h;
<a name="l00142"></a>00142     l-&gt;<a class="code" href="structc__handler__list.html#ad2eb40545e9d26f2788e94366ac0dd16" title="Ultimo handler na lista.">end</a>    = h;
<a name="l00143"></a>00143   }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145   l-&gt;<a class="code" href="structc__handler__list.html#aaede1e019a8e47f5958816d7d023abfa" title="Quantos handlers estao servindo clientes agora.">current</a>++;
<a name="l00146"></a>00146   <span class="keywordflow">return</span> 0;
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 
<a name="l00163"></a><a class="code" href="client_8h.html#ac292abf6962c7f09db30f632b21aa11f">00163</a> <span class="keywordtype">int</span> <a class="code" href="client_8h.html#ac292abf6962c7f09db30f632b21aa11f" title="Remove &#39;h&#39; de &#39;l&#39;.">c_handler_remove</a>(<span class="keyword">struct</span> c_handler* h, <span class="keyword">struct</span> <a class="code" href="structc__handler__list.html">c_handler_list</a>* l)
<a name="l00164"></a>00164 {
<a name="l00165"></a>00165   <span class="keyword">struct </span>c_handler* tmp = NULL;
<a name="l00166"></a>00166   <span class="keywordtype">int</span> exists = 0;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   <span class="keywordflow">if</span> ((h == NULL) || (l == NULL))
<a name="l00169"></a>00169     <span class="keywordflow">return</span> -1;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171   <span class="keywordflow">if</span> ((l-&gt;<a class="code" href="structc__handler__list.html#a51e2205f099981d10b5709725950a892" title="Primeiro handler na lista.">begin</a> == NULL) || (l-&gt;<a class="code" href="structc__handler__list.html#ad2eb40545e9d26f2788e94366ac0dd16" title="Ultimo handler na lista.">end</a> == NULL) || (l-&gt;<a class="code" href="structc__handler__list.html#aaede1e019a8e47f5958816d7d023abfa" title="Quantos handlers estao servindo clientes agora.">current</a> == 0))
<a name="l00172"></a>00172     <span class="keywordflow">return</span> -1;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174   <span class="comment">//checar se h esta realmente em l</span>
<a name="l00175"></a>00175   tmp = l-&gt;<a class="code" href="structc__handler__list.html#a51e2205f099981d10b5709725950a892" title="Primeiro handler na lista.">begin</a>;
<a name="l00176"></a>00176   <span class="keywordflow">do</span> {
<a name="l00177"></a>00177     <span class="keywordflow">if</span> (tmp == h)
<a name="l00178"></a>00178       exists = 1;
<a name="l00179"></a>00179     tmp = tmp-&gt;next;
<a name="l00180"></a>00180   } <span class="keywordflow">while</span> ((exists == 0) &amp;&amp; (tmp != NULL));
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   <span class="keywordflow">if</span> (exists == 0)
<a name="l00183"></a>00183     <span class="keywordflow">return</span> -1;
<a name="l00184"></a>00184 
<a name="l00185"></a>00185   <span class="comment">//efetivamente remover</span>
<a name="l00186"></a>00186   <span class="keywordflow">if</span> (l-&gt;<a class="code" href="structc__handler__list.html#a51e2205f099981d10b5709725950a892" title="Primeiro handler na lista.">begin</a> == h)
<a name="l00187"></a>00187   {
<a name="l00188"></a>00188     <span class="keywordflow">if</span> (h-&gt;next == NULL)
<a name="l00189"></a>00189       l-&gt;<a class="code" href="structc__handler__list.html#ad2eb40545e9d26f2788e94366ac0dd16" title="Ultimo handler na lista.">end</a> = NULL;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     l-&gt;<a class="code" href="structc__handler__list.html#a51e2205f099981d10b5709725950a892" title="Primeiro handler na lista.">begin</a> = h-&gt;next;
<a name="l00192"></a>00192     h-&gt;next = NULL;
<a name="l00193"></a>00193   }
<a name="l00194"></a>00194   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l-&gt;<a class="code" href="structc__handler__list.html#ad2eb40545e9d26f2788e94366ac0dd16" title="Ultimo handler na lista.">end</a> == h)
<a name="l00195"></a>00195   {
<a name="l00196"></a>00196     tmp = l-&gt;<a class="code" href="structc__handler__list.html#a51e2205f099981d10b5709725950a892" title="Primeiro handler na lista.">begin</a>;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     <span class="keywordflow">while</span> (tmp-&gt;next != h)
<a name="l00199"></a>00199       tmp = tmp-&gt;next;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     l-&gt;<a class="code" href="structc__handler__list.html#ad2eb40545e9d26f2788e94366ac0dd16" title="Ultimo handler na lista.">end</a> = tmp;
<a name="l00202"></a>00202     tmp-&gt;next = NULL;
<a name="l00203"></a>00203   }
<a name="l00204"></a>00204   <span class="keywordflow">else</span>
<a name="l00205"></a>00205   {
<a name="l00206"></a>00206     <span class="keywordflow">while</span> (tmp-&gt;next != h)
<a name="l00207"></a>00207       tmp = tmp-&gt;next;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209     tmp-&gt;next = h-&gt;next;
<a name="l00210"></a>00210     h-&gt;next = NULL;
<a name="l00211"></a>00211   }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213   l-&gt;<a class="code" href="structc__handler__list.html#aaede1e019a8e47f5958816d7d023abfa" title="Quantos handlers estao servindo clientes agora.">current</a>--;
<a name="l00214"></a>00214   <span class="keywordflow">return</span> 0;
<a name="l00215"></a>00215 }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 
<a name="l00222"></a><a class="code" href="client_8h.html#ab3801b809e73cccfd6187e4b01d47b45">00222</a> <span class="keywordtype">void</span> <a class="code" href="client_8h.html#ab3801b809e73cccfd6187e4b01d47b45" title="Libera a memoria alocada para &#39;h&#39;.">c_handler_exit</a>(<span class="keyword">struct</span> c_handler* h)
<a name="l00223"></a>00223 {
<a name="l00224"></a>00224   free(h);
<a name="l00225"></a>00225   h = NULL;
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00238"></a>00238 <span class="keyword">struct </span><a class="code" href="structclienthandler__t.html" title="O responsavel por fornecer o servico ao cliente.">clienthandler_t</a>
<a name="l00239"></a>00239 {
<a name="l00240"></a><a class="code" href="structclienthandler__t.html#a12499815520a737bbb014c30c68f03b5">00240</a>   <span class="keywordtype">int</span>  <a class="code" href="structclienthandler__t.html#a12499815520a737bbb014c30c68f03b5" title="Socket do cliente servido.">client</a>;                   
<a name="l00241"></a><a class="code" href="structclienthandler__t.html#a9ed63036d91f809f7b5010270b6025ae">00241</a>   <span class="keywordtype">int</span>  <a class="code" href="structclienthandler__t.html#a9ed63036d91f809f7b5010270b6025ae" title="Estado em que se encontra o handler.">state</a>;                    
<a name="l00242"></a><a class="code" href="structclienthandler__t.html#a19ac19c6ceb9af6fdad925e2c7464e72">00242</a>   <span class="keywordtype">char</span> <a class="code" href="structclienthandler__t.html#a19ac19c6ceb9af6fdad925e2c7464e72" title="Toda a request HTTP solicitada pelo cliente.">request</a>[BUFFER_SIZE * 3]; 
<a name="l00243"></a><a class="code" href="structclienthandler__t.html#a77d8121ffb9e1485c88343a6356ec652">00243</a>   <span class="keywordtype">int</span>  <a class="code" href="structclienthandler__t.html#a77d8121ffb9e1485c88343a6356ec652" title="Tamanho de caracteres que &#39;request&#39; suporta.">request_size</a>;             
<a name="l00244"></a><a class="code" href="structclienthandler__t.html#a4403634dcbf5da4a69468975be57ec10">00244</a>   <span class="keywordtype">char</span> <a class="code" href="structclienthandler__t.html#a4403634dcbf5da4a69468975be57ec10" title="Localizacao do arquivo que o cliente solicitou.">filepath</a>[BUFFER_SIZE];    
<a name="l00245"></a><a class="code" href="structclienthandler__t.html#ae4675cda2585cb34627557d6ab2f71d1">00245</a>   <span class="keywordtype">int</span>  <a class="code" href="structclienthandler__t.html#ae4675cda2585cb34627557d6ab2f71d1" title="Indica se o arquivo existe ou qual erro esta associado a ele.">filestatus</a>;               
<a name="l00247"></a><a class="code" href="structclienthandler__t.html#a9aaa95434ccb69abc789feb1c5cb1af6">00247</a>   <span class="keywordtype">char</span> <a class="code" href="structclienthandler__t.html#a9aaa95434ccb69abc789feb1c5cb1af6" title="Mensagem equivalente ao status do arquivo.">filestatusmsg</a>[BUFFER_SIZE]; 
<a name="l00248"></a><a class="code" href="structclienthandler__t.html#a7ee67d93b9765f4f71117a2aecdcddce">00248</a>   FILE* <a class="code" href="structclienthandler__t.html#a7ee67d93b9765f4f71117a2aecdcddce" title="Arquivo que o cliente pede.">filep</a>;                   
<a name="l00249"></a><a class="code" href="structclienthandler__t.html#a22b2bfd7bd5dbbf2975436b0e43c0cee">00249</a>   <span class="keywordtype">int</span>   <a class="code" href="structclienthandler__t.html#a22b2bfd7bd5dbbf2975436b0e43c0cee" title="Tamanho do arquivo solicitado.">filesize</a>;                
<a name="l00250"></a><a class="code" href="structclienthandler__t.html#a593bef3a0aaad5fc458c6f238b9f6d35">00250</a>   <span class="keywordtype">int</span>   <a class="code" href="structclienthandler__t.html#a593bef3a0aaad5fc458c6f238b9f6d35" title="Tamanho que ja foi enviado do arquivo como um todo.">filesentsize</a>;            
<a name="l00251"></a><a class="code" href="structclienthandler__t.html#a42b5b871dabcb232c49d52d94c802fc7">00251</a>   time_t <a class="code" href="structclienthandler__t.html#a42b5b871dabcb232c49d52d94c802fc7" title="Data de ultima modificacao do arquivo.">filelastm</a>;              
<a name="l00252"></a><a class="code" href="structclienthandler__t.html#a203df4f2aedfffb9fb6c552a62fe674a">00252</a>   <span class="keywordtype">char</span> <a class="code" href="structclienthandler__t.html#a203df4f2aedfffb9fb6c552a62fe674a" title="Buffer onde serao guardadas partes temporarias do arquivo.">filebuff</a>[BUFFER_SIZE];    
<a name="l00253"></a><a class="code" href="structclienthandler__t.html#a26e4d3062c1cd061ede35c2b7e933c17">00253</a>   <span class="keywordtype">char</span>  <a class="code" href="structclienthandler__t.html#a26e4d3062c1cd061ede35c2b7e933c17" title="Header a ser enviado como resposta ao cliente, antes do arquivo.">answer</a>[BUFFER_SIZE];     
<a name="l00254"></a><a class="code" href="structclienthandler__t.html#aabcc116e46b7a42029b70365e4a19a90">00254</a>   <span class="keywordtype">int</span>   <a class="code" href="structclienthandler__t.html#aabcc116e46b7a42029b70365e4a19a90" title="O tamanho total do header.">answer_size</a>;             
<a name="l00256"></a><a class="code" href="structclienthandler__t.html#a7ae116dd44fb7963d8316bf07faa67fd">00256</a>   <span class="keywordtype">int</span> <a class="code" href="structclienthandler__t.html#a7ae116dd44fb7963d8316bf07faa67fd" title="Quanto do arquivo (caso exista) ainda precisa ser enviado ao cliente.">size_left</a>; 
<a name="l00257"></a><a class="code" href="structclienthandler__t.html#a1932f487da8a6d46e4f836c1d381940b">00257</a>   <span class="keywordtype">int</span> <a class="code" href="structclienthandler__t.html#a1932f487da8a6d46e4f836c1d381940b" title="Quanto do arquivo (caso exista) ja foi enviado ao cliente.">size_sent</a>; 
<a name="l00259"></a>00259   <span class="keywordtype">char</span> fileerror[BUFFER_SIZE]; 
<a name="l00261"></a><a class="code" href="structclienthandler__t.html#ac1a3c8cccebc74433468b122c57011a4">00261</a>   <span class="keywordtype">int</span> <a class="code" href="structclienthandler__t.html#ac1a3c8cccebc74433468b122c57011a4" title="Se houver algum erro relacionado ao arquivo, sua mensagem estara aqui (no formato de pagina HTML) par...">fileerrorsize</a>; 
<a name="l00262"></a><a class="code" href="structclienthandler__t.html#a7fc8db1e06e95182513f9f855f4cde9d">00262</a>   <span class="keywordtype">char</span> *<a class="code" href="structclienthandler__t.html#a7fc8db1e06e95182513f9f855f4cde9d" title="Ponteiro que vai indicar o que vai ser enviado - o erro ou o header.">output</a>; 
<a name="l00264"></a>00264   <span class="keywordtype">int</span> need_file_chunk;           
<a name="l00265"></a>00265 };
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 
<a name="l00270"></a><a class="code" href="client_8h.html#aa19be6305a5a4485e1e70de70ed7d677">00270</a> <span class="keyword">enum</span> <a class="code" href="client_8h.html#aa19be6305a5a4485e1e70de70ed7d677" title="Todos os estados possiveis do clienthandler_t.">states</a> { FINISHED, MSG_RECEIVING, FILE_PROCESSING, HEADER_SENDING, ERROR_HEADER_SENDING, FILE_SENDING, ERROR_SENDING,
<a name="l00271"></a>00271                         MSG_RECEIVED,                   HEADER_SENT,    ERROR_HEADER_SENT,    FILE_SENT,     ERROR_SENT   };
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 <span class="keywordtype">int</span>  <a class="code" href="client_8c.html#aa66d207eaa7068cb6dc910a25732767d" title="Recebe a mensagem atraves de recv() de uma maneira nao-bloqueante.">receive_message</a>(<span class="keyword">struct</span> <a class="code" href="structclienthandler__t.html" title="O responsavel por fornecer o servico ao cliente.">clienthandler_t</a>* h);
<a name="l00275"></a>00275 <span class="keywordtype">int</span>  <a class="code" href="client_8c.html#a7a1ed6b5ae8b21250e2aa559b4860f47" title="Inicializa o clienthandler_t &#39;h&#39; e associa seus servicos ao cliente representado por &#39;clientsckt&#39;...">handler_init</a>(<span class="keyword">struct</span> <a class="code" href="structclienthandler__t.html" title="O responsavel por fornecer o servico ao cliente.">clienthandler_t</a>* h, <span class="keywordtype">int</span> sck, <span class="keywordtype">char</span>* rootdir);
<a name="l00276"></a>00276 <span class="keywordtype">int</span>  <a class="code" href="client_8c.html#ae7382604d8402a2275091a968798a84c" title="Checa se o arquivo descrito dentro de &#39;h&#39; existe ou nao e atribui a &#39;h&#39; a mensagem de erro correspond...">file_check</a>(<span class="keyword">struct</span> <a class="code" href="structclienthandler__t.html" title="O responsavel por fornecer o servico ao cliente.">clienthandler_t</a>* h, <span class="keywordtype">char</span>* rootdir, <span class="keywordtype">int</span> rootdirsize);
<a name="l00277"></a>00277 <span class="keywordtype">int</span>  start_sending_msg(<span class="keyword">struct</span> <a class="code" href="structclienthandler__t.html" title="O responsavel por fornecer o servico ao cliente.">clienthandler_t</a>* h);
<a name="l00278"></a>00278 <span class="keywordtype">int</span>  <a class="code" href="client_8c.html#ab497f7be87da1575a3ff333bd6d3e38e" title="Continua enviando para h-&gt;client a mensagem apontada por h-&gt;output atraves de sockets nao-bloqueantes...">keep_sending_msg</a>(<span class="keyword">struct</span> <a class="code" href="structclienthandler__t.html" title="O responsavel por fornecer o servico ao cliente.">clienthandler_t</a>* h);
<a name="l00279"></a>00279 <span class="keywordtype">int</span>  <a class="code" href="client_8c.html#a4ab6c1dd3a90503c8451377a99f7ec34" title="Abre o arquivo em &#39;h&#39; para ser enviado.">start_sending_file</a>(<span class="keyword">struct</span> <a class="code" href="structclienthandler__t.html" title="O responsavel por fornecer o servico ao cliente.">clienthandler_t</a>* h);
<a name="l00280"></a>00280 <span class="keywordtype">int</span>  <a class="code" href="client_8c.html#a4478a7db4cc6c509dee800d60d367ffa" title="Fecha o arquivo aberto para o &#39;h&#39;.">stop_sending_file</a>(<span class="keyword">struct</span> <a class="code" href="structclienthandler__t.html" title="O responsavel por fornecer o servico ao cliente.">clienthandler_t</a>* h);
<a name="l00281"></a>00281 <span class="keywordtype">int</span>  <a class="code" href="client_8c.html#af1c7af2db69f3af2f81fab908676f54a" title="Pega um pedaco do arquivo e guarda no buffer dentro de &#39;h&#39;.">get_file_chunk</a>(<span class="keyword">struct</span> <a class="code" href="structclienthandler__t.html" title="O responsavel por fornecer o servico ao cliente.">clienthandler_t</a>* h);
<a name="l00282"></a>00282 <span class="keywordtype">void</span> <a class="code" href="client_8c.html#a64e42ddaad27d84a87591f2489a13156" title="Constroi e armazena em &#39;h-&gt;fileerror&#39; uma pagina HTML contendo o erro ocorrido.">build_error_html</a>(<span class="keyword">struct</span> <a class="code" href="structclienthandler__t.html" title="O responsavel por fornecer o servico ao cliente.">clienthandler_t</a>* h);
<a name="l00283"></a>00283 <span class="keywordtype">int</span>  <a class="code" href="client_8c.html#ac72fa8af4570ea19e005adcabf336a71" title="Separa as partes uteis da request HTTP enviada pelo usuario.">parse_request</a>(<span class="keyword">struct</span> <a class="code" href="structclienthandler__t.html" title="O responsavel por fornecer o servico ao cliente.">clienthandler_t</a>* h);
<a name="l00284"></a>00284 <span class="keywordtype">int</span>  <a class="code" href="client_8c.html#a5266eb1a812dec153baa22ba231d6766" title="Constroi e atribui o header HTTP ao &#39;buf&#39; (respeitando &#39;bufsize&#39;).">build_header</a>(<span class="keyword">struct</span> <a class="code" href="structclienthandler__t.html" title="O responsavel por fornecer o servico ao cliente.">clienthandler_t</a>* h);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="preprocessor">#endif </span><span class="comment">/* CLIENT_H_DEFINED */</span>
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>Todos</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Estruturas de Dados</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Arquivos</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Funções</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variáveis</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerações</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Gerado em Quarta, 25 de Janeiro de 2012 17:35:06 para servw por &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5
</small></address>

</body>
</html>
